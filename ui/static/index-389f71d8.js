import{_ as Y,L as R,r as I,w as Z,z as B,c as s,M as p,g as e,f as t,j as i,I as T,e as b,d as $,N as ee,O as te,H as ae,P as F,n as U,Q as le,ab as se,a as oe,R as ne,S as z,G as n,T as M,l as re,m as ie,E as ue}from"./index-95613dab.js";import{E as pe}from"./el-pagination-85d088f5.js";import{E as de,a as ce}from"./el-table-column-4a0e4f66.js";import"./el-select-4c2944db.js";import"./el-checkbox-b30da6b0.js";import{E as me,a as _e}from"./el-col-70d140ea.js";import{d as ge,g as fe,a as ve}from"./api-4d4a2e68.js";import{u as ye}from"./page-5f943eec.js";import{u as O,r as be}from"./websocket-41ae5265.js";import{E as P}from"./index-caf59b3e.js";import{v as we}from"./directive-ec7dcf29.js";import{E as ke}from"./index-d37ca481.js";const xe={__name:"do-deploy",props:{visible:{type:Boolean},visibleModifiers:{},formData:{type:Object},formDataModifiers:{}},emits:["update:visible","update:formData"],setup(N){const{logMessage:w,statusMessage:k}=O("/websocket"),g=R(N,"visible"),m=R(N,"formData"),d=I();Z(w,async()=>{await ae(),d.value.scrollTop=d.value.scrollHeight},{deep:!0});const f=B(()=>w.value.get(m.value.id)),v=B(()=>k.value.get(m.value.id)),u=B(()=>{switch(k.value.get(m.value.id)){case 0:return{text:"上线",type:"primary"};case 1:return{text:"上线中",type:"default"};case 2:return{text:"重新上线",type:"success"};case 3:return{text:"重新上线",type:"warning"}}return{}}),V=async()=>{v.value!=0&&await P.confirm("是否重新上线","警告"),await ge(m.value.id),g.value=!1,F.success("成功")},x=C=>{switch(C){case 0:return"gray";case 1:return"green";case 2:return"yellow";case 3:return"red"}return"green"};return(C,c)=>{const h=U,y=le;return s(),p(y,{title:"发布项目/"+m.value.deployName,modelValue:g.value,"onUpdate:modelValue":c[2]||(c[2]=l=>g.value=l),"close-on-click-modal":!1,width:"50%"},{footer:e(()=>[t(h,{onClick:c[0]||(c[0]=l=>g.value=!1)},{default:e(()=>[i("关 闭")]),_:1}),t(h,{type:u.value.type,onClick:c[1]||(c[1]=l=>V()),loading:v.value==1},{default:e(()=>[i(T(u.value.text),1)]),_:1},8,["type","loading"])]),default:e(()=>[b("div",{class:"message-box",ref_key:"messageInnerRef",ref:d},[(s(!0),$(te,null,ee(f.value,l=>(s(),$("div",{class:"message-text",key:l},[b("pre",{style:se({color:x(l.type)})},T(l.createTime)+" "+T(l.message),5)]))),128))],512)]),_:1},8,["title","modelValue"])}}},Ce=Y(xe,[["__scopeId","data-v-fc8b10a1"]]),he={class:"app-container"},De=b("p",{class:"page-title"},"上线单列表",-1),Ee={class:"filter-container"},ze={class:"page-container"},Ue={__name:"index",setup(N){const w=oe(),{websocketTarget:k,logMessage:g,statusMessage:m}=O(),d=async()=>{f.value=!0;const{data:o}=await fe(u.value);v.value=o.data,x.value=o.total,f.value=!1};be("status_change",d);const{tableLoading:f,list:v,params:u,pageSizes:V,total:x,handleSizeChange:C,handleCurrentChange:c}=ye(d),h=()=>{w.push("/deploy/add")},y=I(!1),l=I({}),H=o=>{y.value=!0,l.value=o,m.value.set(o.id,o.status),g.value.has(o.id)||k.value.send(`{"msgType":"init","data":${o.id}}`)},q=async o=>{await P.confirm("删除上线单不可恢复","警告");const{message:r}=await ve(o.id);F.success(r),d()};return(o,r)=>{const D=U,j=_e,A=re,L=ie,G=ue,Q=me,_=ce,E=ke,W=de,J=pe,S=ne("permission"),K=we;return s(),$("div",he,[De,b("div",Ee,[t(Q,{gutter:20,justify:"space-between"},{default:e(()=>[t(j,{span:6},{default:e(()=>[z((s(),p(D,{type:"primary",size:"default",plain:"",onClick:r[0]||(r[0]=a=>h())},{default:e(()=>[i(" 新建上线单 ")]),_:1})),[[S,"deploy:add"]])]),_:1}),t(j,{span:18},{default:e(()=>[t(G,{ref:"queryFormRef",inline:"",style:{float:"right"},size:"default",model:n(u)},{default:e(()=>[t(L,{label:"上线单",prop:"name"},{default:e(()=>[t(A,{modelValue:n(u).name,"onUpdate:modelValue":r[1]||(r[1]=a=>n(u).name=a),clearable:""},null,8,["modelValue"])]),_:1}),t(L,null,{default:e(()=>[t(D,{type:"primary",onClick:d},{default:e(()=>[i("查询")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),z((s(),p(W,{"element-loading-text":"加载中...",border:"",data:n(v)},{default:e(()=>[t(_,{label:"ID",prop:"id",align:"center",width:"60px"}),t(_,{align:"center",label:"上线单","show-overflow-tooltip":"",prop:"deployName"}),t(_,{align:"center",label:"上线项目","show-overflow-tooltip":"",prop:"projectName"}),t(_,{align:"center",label:"使用模板","show-overflow-tooltip":"",prop:"templateName"}),t(_,{align:"center",label:"更新时间",width:"180px",prop:"updateTime"}),t(_,{align:"center",label:"状态",width:"100px",prop:"status"},{default:e(({row:a})=>[a.status==0?(s(),p(E,{key:0,type:"warning"},{default:e(()=>[i("待上线")]),_:1})):M("",!0),a.status==1?(s(),p(E,{key:1,type:"primary"},{default:e(()=>[i("上线中")]),_:1})):M("",!0),a.status==2?(s(),p(E,{key:2,type:"success"},{default:e(()=>[i("上线成功")]),_:1})):M("",!0),a.status==3?(s(),p(E,{key:3,type:"danger"},{default:e(()=>[i("上线失败")]),_:1})):M("",!0)]),_:1}),t(_,{align:"center",width:"170px",label:"操作"},{default:e(({row:a})=>[z((s(),p(D,{size:"small",loading:a.status==1,type:"primary",onClick:X=>H(a)},{default:e(()=>[i(T(a.status==2?"查看":"上线"),1)]),_:2},1032,["loading","onClick"])),[[S,"deploy:deploy"]]),z((s(),p(D,{size:"small",type:"danger",onClick:X=>q(a)},{default:e(()=>[i(" 删除 ")]),_:2},1032,["onClick"])),[[S,"deploy:del"]])]),_:1})]),_:1},8,["data"])),[[K,n(f)]]),b("div",ze,[t(J,{background:"","current-page":n(u).page,"page-sizes":n(V),"page-size":n(u).pageSize,layout:"total, sizes, prev, pager, next, jumper",total:n(x),onSizeChange:n(C),onCurrentChange:n(c)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"])]),t(Ce,{visible:y.value,"onUpdate:visible":r[2]||(r[2]=a=>y.value=a),formData:l.value,"onUpdate:formData":r[3]||(r[3]=a=>l.value=a)},null,8,["visible","formData"])])}}};export{Ue as default};
